<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chimera Café — Interactive Lore Experience</title>

    <style>
        body {
            margin:0;
            background:#0a0a0f;
            color:#eee;
            font-family:'Segoe UI', sans-serif;
            overflow-x:hidden;
        }

        .gallery {
            display:grid;
            grid-template-columns:repeat(6, 1fr);
            grid-gap:2px;
        }

        .tile {
            width:100%;
            padding-top:100%;
            position:relative;
            overflow:hidden;
            cursor:pointer;
        }

        .tile img {
            position:absolute;
            top:0; left:0;
            width:100%; height:100%;
            object-fit:cover;
            filter:blur(1px) grayscale(0.3) brightness(0.8);
            transition:0.3s;
        }

        .tile:hover img {
            filter:blur(0) grayscale(0) brightness(1);
            transform:scale(1.05);
        }

        #popupContainer {
            position:fixed; top:0; left:0;
            width:100%; height:100%;
            background:rgba(0,0,0,0.85);
            display:none;
            justify-content:center;
            align-items:flex-start;
            padding-top:50px;
            z-index:1000;
            overflow-y:auto;
        }

        #popupContent {
            background:#1a1a22;
            padding:20px;
            border-radius:10px;
            max-width:800px;
            width:90%;
            color:#ddd;
            box-shadow:0 0 20px #5a2d99;
        }

        #popupActions button {
            margin:10px 5px;
            padding:10px 15px;
            cursor:pointer;
            background:#6c2cff;
            border:none;
            border-radius:6px;
            color:white;
        }

        @keyframes fadeMystery {
            from {opacity:0;}
            to {opacity:1;}
        }
    </style>
</head>

<body>

<div class="gallery" id="gallery"></div>

<!-- Popup Window -->
<div id="popupContainer">
    <div id="popupContent">
        <div id="popupText"></div>
        <div id="popupActions"></div>
        <button onclick="closePopup()">Close</button>
    </div>
</div>

<script>
/* --------------------------------------------- */
/*           THUMBNAILS (PLACEHOLDERS)           */
/* --------------------------------------------- */

const thumbnails = {
    starPortrait:"images/star.png",
    hansPortrait:"images/hans.png",
    miloPortrait:"images/milo.png",
    mikiPortrait:"images/miki.png",
    chariPortrait:"images/chari.png",

    cafeExterior:"images/cafeExterior.png",
    cafeInterior:"images/cafeInterior.png",
    loreRoom:"images/loreRoom.png",

    musicRoom:"images/musicRoom.png",
    secretLetter:"images/secretLetter.png",

    escapeRoom:"images/escapeRoom.png",
    yeshuaRescue:"images/yeshuaRescue.png",

    lavenderTea:"images/lavenderTea.png",
    matchaBlend:"images/matchaBlend.png"
};

/* --------------------------------------------- */
/*                 CODEX DATA                    */
/* --------------------------------------------- */

const codexData = {
    characters:{
        star:{ name:"Star", image:thumbnails.starPortrait,
            text:`Star is the edgy, gothy owner of the Chimera Café. She reads romance novels 
            and studies Scripture. She protects her siblings fiercely.`,
            unlocked:true
        },

        hans:{ name:"Hans — Tea Snob", image:thumbnails.hansPortrait,
            text:`Hans is a sarcastic British chimera. He will judge your tea. Mercilessly.`,
            unlocked:true
        },

        milo:{ name:"Milo — Zen Herb Gardener", image:thumbnails.miloPortrait,
            text:`Soft-spoken, part Korean, part Parisian. Studies Taoism. Walks in Yeshua’s love.
            Tends herbs and minds the spiritual balance.`,
            unlocked:false
        },

        miki:{ name:"Miki — Musician Chimera", image:thumbnails.mikiPortrait,
            text:`First to escape the Paris lab.
            Black emo hair with neon yellow stripe.
            Loves matcha. Unlock music by solving riddles.`,
            unlocked:false,
            musicTracks:[
                {title:"Track 1", url:"music/track1.mp3", unlocked:false},
                {title:"Track 2", url:"music/track2.mp3", unlocked:false},
                {title:"Track 3", url:"music/track3.mp3", unlocked:false},
                {title:"Track 4", url:"music/track4.mp3", unlocked:false}
            ]
        },

        chari:{ name:"Chari — Young Cat-Rat Hybrid", image:thumbnails.chariPortrait,
            text:`Anxious, quiet, carries two emotional support rats.
            Shy but deeply observant. Learning café work.`,
            unlocked:false
        }
    },

    hiddenSecrets:{
        musicRoom:{ name:"Miki’s Music Room", image:thumbnails.musicRoom,
            text:`A neon sanctuary of sound. Unlock via riddles.`,
            unlocked:false
        },

        secretLetter:{ name:"Yeshua’s Letter", image:thumbnails.secretLetter,
            text:`A hidden letter describing the rescue of the chimera siblings.`,
            unlocked:false
        },

        enlightenmentRealm:{ name:"Realm of Light", image:thumbnails.loreRoom,
            text:`A realm revealed after answering Milo's wisdom questions.`,
            unlocked:false
        },

        musicRealm:{ name:"Neon Sound Realm", image:thumbnails.musicRoom,
            text:`A cosmic realm accessed through musical mastery.`,
            unlocked:false
        }
    },

    rescueChronicles:{
        madScientistEscape:{ name:"The Escape", image:thumbnails.escapeRoom,
            text:`The chimera siblings broke free from the lab. A night of terror and hope.`,
            unlocked:false
        },

        yeshuaRescue:{ name:"Yeshua’s Intervention", image:thumbnails.yeshuaRescue,
            text:`A light that shattered darkness. Yeshua rescued them.`,
            unlocked:false
        }
    },

    cafeMenu:{
        lavenderTea:{ name:"Lavender Tea", image:thumbnails.lavenderTea,
            text:`Hans’ favorite calming blend.`,
            unlocked:false
        },

        matchaBlend:{ name:"Miki’s Matcha Blend", image:thumbnails.matchaBlend,
            text:`A sharp green tea with neon energy.`,
            unlocked:false
        }
    }
};

/* --------------------------------------------- */
/*                POPUP SYSTEM                   */
/* --------------------------------------------- */

function openPopup(title, html, actions=[]) {
    document.getElementById("popupText").innerHTML = `<h2>${title}</h2>${html}`;
    const act = document.getElementById("popupActions");
    act.innerHTML = "";
    actions.forEach(a=>{
        let b=document.createElement("button");
        b.textContent=a.label;
        b.onclick=a.action;
        act.appendChild(b);
    });
    document.getElementById("popupContainer").style.display="flex";
}

function closePopup(){
    document.getElementById("popupContainer").style.display="none";
}

/* --------------------------------------------- */
/*           MYSTERY LINK (external)             */
/* --------------------------------------------- */

function openMysteryLink(url) {
    const layer=document.createElement("div");
    layer.style=`
        position:fixed;top:0;left:0;width:100%;height:100%;
        background:rgba(50,0,90,0.4);
        backdrop-filter:blur(5px);
        animation:fadeMystery 1s forwards;
        z-index:9999;
    `;
    document.body.appendChild(layer);

    setTimeout(()=>window.open(url, "_blank"),800);
    setTimeout(()=>layer.remove(),1500);
}

/* --------------------------------------------- */
/*                 CHATBOTS                      */
/* --------------------------------------------- */

function hansChat(){
    openPopup("Hans",
        `<p>Well well well… look what the chimera-cat dragged in.</p>
        <p>What do you want then? Tea? A personality upgrade?</p>`,
        [
            {label:"Ask about tea", action:()=>alert("Hans: Your palate may not be ready for my blends…")},
            {label:"Ask about siblings", action:()=>alert("Hans: They’re tolerable. Mostly.")},
        ]
    );
}

function starChat(){
    openPopup("Star",
        `<p>Hey traveler. Welcome to my café.</p>
         <p>I used to be lost between worlds, but Yeshua brought me home.</p>`
    );
}

function chariChat(){
    openPopup("Chari",
        `<p>H-Hi… I’m Chari…</p>
         <p>My rats help me when I get scared…</p>`
    );
}

/* --------------------------------------------- */
/*          MIKI’S MUSIC ROOM + RIDDLES          */
/* --------------------------------------------- */

function openMikiMusicRoom() {
    if (!codexData.hiddenSecrets.musicRoom.unlocked) {
        openPopup("Locked","Solve Miki’s riddles first.");
        return;
    }

    openPopup("Miki’s Music Room",
        `<p>The neon lights hum with energy.</p>
         <div id="musicTracksContainer"></div>`
    );

    updateMikiMusicTracksUI();
}

function updateMikiMusicTracksUI() {
    const div=document.getElementById("musicTracksContainer");
    if(!div) return;

    let html="";
    codexData.characters.miki.musicTracks.forEach((t,i)=>{
        html+=`
        <div style="border:1px solid #444; margin:10px; padding:10px;">
            <b>${t.title}</b><br>
            ${t.unlocked?`
                <audio controls src="${t.url}"></audio><br>
                <a href="${t.url}" download>Download</a>
            `:`
                <p>Locked — Solve riddle:</p>
                <button onclick="askMikiRiddle(${i})">Solve</button>
            `}
        </div>`;
    });

    div.innerHTML = html;

    // Unlock Neon Sound Realm
    if (codexData.characters.miki.musicTracks.every(t=>t.unlocked)) {
        codexData.hiddenSecrets.musicRealm.unlocked = true;
    }
}

function askMikiRiddle(i){
    const riddles=[
        "Who escaped the Paris lab first?",
        "What color is Miki’s neon hair stripe?",
        "What drink does Miki love most?",
        "Bonus: What city was she experimented in?"
    ];

    const answers=["miki","yellow","matcha","paris"];

    let user = prompt(riddles[i]);
    if(!user) return;

    if(user.toLowerCase().trim()===answers[i]){
        codexData.characters.miki.musicTracks[i].unlocked = true;
        codexData.hiddenSecrets.musicRoom.unlocked = true;
        alert("Correct!");
        updateMikiMusicTracksUI();
    } else {
        alert("Incorrect. Try again.");
    }
}

/* --------------------------------------------- */
/*           MILO — WISDOM CHAMBER               */
/* --------------------------------------------- */

function openMiloChamber(){
    openPopup("Milo’s Chamber",
        `<p>Milo bows slightly. Incense drifts softly.</p>
         <p><i>“Peace, traveler. The Way is gentle.”</i></p>
         <div id="miloQuizArea"></div>`
    );
    loadMiloQuiz();
}

const miloQuestions=[
    {q:"What virtue does Yeshua emphasize above all?", a:"love"},
    {q:"In Taoism, the Way is like flowing…?", a:"water"},
    {q:"Romans teaches salvation comes by confessing with your… what?", a:"mouth"}
];

let miloIndex=0;

function loadMiloQuiz(){
    const area=document.getElementById("miloQuizArea");
    if(!area) return;

    area.innerHTML=`
        <p><b>${miloQuestions[miloIndex].q}</b></p>
        <input id="miloAnswer" style="padding:5px;width:70%;">
        <button onclick="submitMiloAnswer()">Submit</button>
    `;
}

function submitMiloAnswer(){
    const input=document.getElementById("miloAnswer");
    let val=input.value.toLowerCase().trim();

    if(val===miloQuestions[miloIndex].a){
        miloIndex++;
        if(miloIndex>=miloQuestions.length){
            unlockEnlightenmentRealm();
            return;
        }
        alert("Good. Continue walking in light.");
        loadMiloQuiz();
    } else {
        alert("Gentle correction: try again.");
    }
}

function unlockEnlightenmentRealm(){
    codexData.hiddenSecrets.enlightenmentRealm.unlocked = true;

    openPopup("Realm of Light",
        `<h3>✨ You enter the Realm of Light ✨</h3>
         <p>Milo leads you into a glowing reality filled with peace.</p>

         <h4>THE ROMANS ROAD TO SALVATION</h4>

         <p><b>Romans 3:23</b> — All have sinned.</p>
         <p><b>Romans 6:23</b> — Sin leads to death, but the gift of God is eternal life.</p>
         <p><b>Romans 10:9</b> — Confess with your mouth and believe in your heart, and you will be saved.</p>
         <p><b>Romans 10:13</b> — Everyone who calls upon the Lord will be saved.</p>

         <p>You are loved. You are invited. The door is open.</p>`
    );

    miloIndex=0;
}

/* --------------------------------------------- */
/*                GALLERY SETUP                  */
/* --------------------------------------------- */

const galleryTiles = [
    {image:thumbnails.starPortrait, action:starChat},
    {image:thumbnails.hansPortrait, action:hansChat},
    {image:thumbnails.miloPortrait, action:openMiloChamber},
    {image:thumbnails.mikiPortrait, action:()=>openMikiMusicRoom()},
    {image:thumbnails.chariPortrait, action:chariChat},

    {image:thumbnails.cafeExterior, action:()=>openMysteryLink("https://example.com")},
    {image:thumbnails.loreRoom, action:()=>openPopup("Lore Room","Ancient lore awaits…")},
    {image:thumbnails.secretLetter, action:()=>openPopup("Secret Letter","A hidden message appears…")},

    {image:thumbnails.escapeRoom, action:()=>openPopup("Escape","The siblings fled the lab…")},
    {image:thumbnails.yeshuaRescue, action:()=>openPopup("Rescue","Yeshua intervened with light…")},

    {image:thumbnails.lavenderTea, action:()=>openPopup("Lavender Tea","A soothing blend.")},
    {image:thumbnails.matchaBlend, action:()=>openPopup("Matcha Blend","Miki’s favorite drink.")},
];

// Fill to 36
while(galleryTiles.length<36){
    galleryTiles.push({
        image:thumbnails.cafeInterior,
        action:()=>openPopup("Mystery","Something whispers here...")
    });
}

function initGallery(){
    const d=document.getElementById("gallery");
    galleryTiles.forEach(t=>{
        let box=document.createElement("div");
        box.className="tile";
        let img=document.createElement("img");
        img.src=t.image;
        box.appendChild(img);
        box.onclick=t.action;
        d.appendChild(box);
    });
}

initGallery();
</script>

</body>
</html>
