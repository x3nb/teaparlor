import React, { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

/**
 * BlueprintTeaParlour.jsx
 *
 * Single-file React component (default export) that implements a blueprint-style
 * homepage for "Miss Poppins' Mindfulness Café". Built with Tailwind CSS and
 * Framer Motion for animations. Drop into a React app that already has Tailwind
 * configured.
 *
 * Features included (stubbed where appropriate):
 * - Central umbrella hub with 7 virtue panels arranged around it
 * - Hover/Focus animations and expand/collapse "room" panels
 * - Chat toggle (stubbed UI) and Music Drawer (playback stub)
 * - Right-side Virtue Shelf with popovers
 * - Accessible buttons and keyboard support
 *
 * To use:
 * 1. Install dependencies: `npm install framer-motion`
 * 2. Ensure Tailwind CSS is configured in your project.
 * 3. Copy this file to `src/components/BlueprintTeaParlour.jsx` and import it.
 *
 * Notes: The component focuses on UI structure and interaction patterns. Replace
 * the stubbed music/chat logic with your real implementations (audio player,
 * chatbot endpoint, etc.). SVGs are inline so you can easily edit icons.
 */

const VIRTUES = [
  { id: 'grace', title: 'Grace & Action', subtitle: 'The First Teacup', prompt: 'Take one small bold action today, and do it with grace.' },
  { id: 'presence', title: 'Presence & Awareness', subtitle: 'The Still Garden', prompt: 'Sip your tea in silence. Notice one small beauty around you.' },
  { id: 'kindness', title: 'Kindness & Empathy', subtitle: 'The Heart Parlor', prompt: 'Offer a kind word to someone today.' },
  { id: 'wisdom', title: 'Wisdom & Reflection', subtitle: 'The Inner Library', prompt: 'Recall a lesson learned from a mistake.' },
  { id: 'faith', title: 'Faith & Flow', subtitle: 'The Mystic Chamber', prompt: 'Take an inspired step toward the unknown.' },
  { id: 'creativity', title: 'Creativity & Joy', subtitle: 'The Secret Garden', prompt: 'Create something today — a doodle, a poem, a thought.' },
  { id: 'harmony', title: 'Harmony & Wholeness', subtitle: 'The Reflection Room', prompt: 'Combine your virtues into one reflection.' }
];

export default function BlueprintTeaParlour() {
  const [openVirtue, setOpenVirtue] = useState(null);
  const [musicOpen, setMusicOpen] = useState(false);
  const [chatOpen, setChatOpen] = useState(false);
  const [activeTrack, setActiveTrack] = useState(null);
  const [shelfHover, setShelfHover] = useState(null);

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-900 via-sky-950 to-slate-900 text-sky-100 font-sans">
      <div className="max-w-7xl mx-auto p-6 lg:p-12">
        {/* Header */}
        <header className="flex items-center justify-between mb-8">
          <div className="flex items-center gap-4">
            <div className="w-14 h-14 rounded-full bg-sky-800/40 border border-sky-500 flex items-center justify-center">
              {/* Umbrella emblem */}
              <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden>
                <path d="M12 3c-4 0-7 3-8 6 1 0 2 1 2 2v1h12V11c0-1 1-2 2-2-1-3-4-6-8-6z" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
                <path d="M12 21a3 3 0 0 0 3-3h-6a3 3 0 0 0 3 3z" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
              </svg>
            </div>
            <h1 className="text-2xl lg:text-3xl font-medium tracking-wide">Miss Poppins’ Mindfulness Café — Blueprint Parlour</h1>
          </div>

          <div className="flex items-center gap-3">
            <button
              onClick={() => setMusicOpen(m => !m)}
              className="rounded-md px-3 py-2 bg-sky-800/40 border border-sky-500 hover:bg-sky-800/60 focus:outline-none focus:ring-2 focus:ring-sky-400"
              aria-expanded={musicOpen}
            >
              Music
            </button>
            <button
              onClick={() => setChatOpen(c => !c)}
              className="rounded-md px-3 py-2 bg-sky-800/30 border border-sky-500 hover:bg-sky-800/60 focus:outline-none focus:ring-2 focus:ring-sky-400"
              aria-expanded={chatOpen}
            >
              Chat
            </button>
          </div>
        </header>

        {/* Blueprint grid + layout */}
        <main className="relative bg-[url('/grid-pattern.svg')] bg-repeat rounded-xl border border-sky-700/30 p-8">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Left column: three virtue tiles stacked */}
            <div className="flex flex-col gap-6">
              {VIRTUES.slice(0,3).map((v, i) => (
                <VirtueTile key={v.id} virtue={v} onOpen={() => setOpenVirtue(v.id)} isOpen={openVirtue === v.id} index={i} />
              ))}
            </div>

            {/* Center column: Umbrella hub */}
            <div className="flex flex-col items-center justify-center">
              <motion.div initial={{ scale: 0.98 }} animate={{ scale: 1 }} className="p-6 rounded-2xl bg-gradient-to-b from-sky-900/40 to-sky-900/30 border border-sky-600/40 shadow-lg w-full">
                <div className="flex flex-col items-center text-center gap-4">
                  <div className="w-40 h-40 rounded-full bg-sky-800/20 border border-sky-500 flex items-center justify-center">
                    <motion.svg
                      whileHover={{ rotate: 8, scale: 1.03 }}
                      width="96"
                      height="96"
                      viewBox="0 0 24 24"
                      fill="none"
                      aria-hidden
                    >
                      <path d="M12 3c-4 0-7 3-8 6 1 0 2 1 2 2v1h12V11c0-1 1-2 2-2-1-3-4-6-8-6z" stroke="currentColor" strokeWidth="1.6" strokeLinecap="round" strokeLinejoin="round" />
                      <path d="M12 21a3 3 0 0 0 3-3h-6a3 3 0 0 0 3 3z" stroke="currentColor" strokeWidth="1.6" strokeLinecap="round" strokeLinejoin="round" />
                    </motion.svg>
                  </div>

                  <div className="space-y-1">
                    <h2 className="text-xl font-semibold">Miss Poppins’ Mindfulness Café</h2>
                    <p className="text-sm text-sky-300/80">A blueprint-style parlour — follow the lines to your next virtue.</p>
                  </div>

                  <div className="mt-3 grid grid-cols-3 gap-2">
                    {VIRTUES.map((v, idx) => (
                      <button
                        key={v.id}
                        onClick={() => setOpenVirtue(v.id)}
                        className="text-xs rounded-md px-3 py-2 bg-sky-800/30 border border-sky-600/40 hover:bg-sky-800/50 focus:outline-none focus:ring-2 focus:ring-sky-400"
                        aria-pressed={openVirtue === v.id}
                      >
                        {v.title.split('&')[0].trim()}
                      </button>
                    ))}
                  </div>
                </div>
              </motion.div>

              {/* Decorative blueprint lines (SVG) */}
              <svg className="mt-6 w-full h-28" viewBox="0 0 600 120" preserveAspectRatio="none" aria-hidden>
                <defs>
                  <linearGradient id="lineGrad" x1="0" x2="1">
                    <stop offset="0%" stopColor="#60a5fa" stopOpacity="0.06" />
                    <stop offset="100%" stopColor="#7dd3fc" stopOpacity="0.03" />
                  </linearGradient>
                </defs>
                <path d="M20 100 C120 20, 480 20, 580 100" stroke="url(#lineGrad)" strokeWidth="1.5" fill="none" strokeLinecap="round" />
              </svg>
            </div>

            {/* Right column: remaining three virtue tiles stacked */}
            <div className="flex flex-col gap-6">
              {VIRTUES.slice(3,7).map((v, i) => (
                <VirtueTile key={v.id} virtue={v} onOpen={() => setOpenVirtue(v.id)} isOpen={openVirtue === v.id} index={i+3} />
              ))}
            </div>
          </div>

          {/* Right-side Virtue Shelf (vertical) */}
          <aside className="absolute right-6 top-10 flex flex-col gap-3">
            {['Etiquette','Lore','Herb Garden','Proverbs'].map((s, i) => (
              <div key={s} className="relative">
                <button
                  onMouseEnter={() => setShelfHover(s)}
                  onMouseLeave={() => setShelfHover(null)}
                  className="w-12 h-12 rounded-md bg-sky-800/30 border border-sky-600/30 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-sky-400"
                  aria-describedby={`shelf-${i}`}
                >
                  <span className="sr-only">{s}</span>
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden>
                    <path d="M3 7h18M3 12h18M3 17h18" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
                  </svg>
                </button>

                <AnimatePresence>
                  {shelfHover === s && (
                    <motion.div
                      initial={{ opacity: 0, x: 8 }}
                      animate={{ opacity: 1, x: 0 }}
                      exit={{ opacity: 0, x: 8 }}
                      className="absolute right-14 top-0 w-56 bg-sky-900/70 border border-sky-600/30 rounded-md p-3 text-left text-sm"
                      id={`shelf-${i}`}
                    >
                      <strong className="block mb-1">{s}</strong>
                      <p className="text-xs text-sky-300/80">Short description or link — replace with real content.</p>
                    </motion.div>
                  )}
                </AnimatePresence>
              </div>
            ))}
          </aside>

          {/* Expandable virtue detail panel (bottom overlay) */}
          <AnimatePresence>
            {openVirtue && (
              <motion.section
                initial={{ y: 40, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: 40, opacity: 0 }}
                className="absolute left-1/2 transform -translate-x-1/2 bottom-6 w-11/12 lg:w-3/4 bg-sky-900/80 border border-sky-600/40 rounded-xl p-6 shadow-2xl"
                role="dialog"
                aria-modal="true"
              >
                <div className="flex items-start justify-between gap-6">
                  <div>
                    <h3 className="text-xl font-semibold">{VIRTUES.find(v => v.id === openVirtue)?.title}</h3>
                    <p className="text-sm text-sky-300/80 mt-1">{VIRTUES.find(v => v.id === openVirtue)?.subtitle}</p>
                    <p className="mt-4 text-sky-200">{VIRTUES.find(v => v.id === openVirtue)?.prompt}</p>
                  </div>

                  <div className="flex-shrink-0">
                    <button onClick={() => setOpenVirtue(null)} className="px-3 py-1 rounded border border-sky-600/30 bg-sky-800/30">Close</button>
                  </div>
                </div>

                {/* Quick actions (journal, mark done) */}
                <div className="mt-6 flex flex-col md:flex-row gap-3">
                  <textarea aria-label="Reflection journal" placeholder="Write a short reflection..." className="flex-1 min-h-[6rem] rounded-md p-3 bg-sky-800/20 border border-sky-700/30 text-sky-100 resize-y" />
                  <div className="w-48 flex flex-col gap-3">
                    <button className="rounded-md px-3 py-2 bg-sky-700/60 border border-sky-500/30">Mark Done</button>
                    <button className="rounded-md px-3 py-2 bg-transparent border border-sky-500/20">Save to Vault</button>
                  </div>
                </div>
              </motion.section>
            )}
          </AnimatePresence>

          {/* Music Drawer (slide-in from right) */}
          <AnimatePresence>
            {musicOpen && (
              <motion.aside
                initial={{ x: 200 }}
                animate={{ x: 0 }}
                exit={{ x: 200 }}
                className="fixed right-6 top-24 w-72 bg-sky-900/90 border border-sky-600/40 rounded-md p-4 z-50 shadow-2xl"
              >
                <h4 className="text-sm font-semibold">Music Drawer</h4>
                <p className="text-xs text-sky-300/70 mb-3">Choose a calming track — playback is stubbed for now.</p>
                <div className="flex flex-col gap-2">
                  {['Gentle Chimes','Soft Strings','Ambient Breeze','Mellow Twilight'].map(track => (
                    <button
                      key={track}
                      onClick={() => setActiveTrack(track)}
                      className={`text-left rounded-md px-3 py-2 border border-sky-600/30 ${activeTrack===track ? 'bg-sky-700/50' : 'bg-sky-800/20'}`}
                    >
                      {track}
                    </button>
                  ))}

                  <div className="mt-3 text-xs text-sky-300/70">(Integrate your audio player; when a track plays, set activeTrack and pause others.)</div>
                </div>
              </motion.aside>
            )}
          </AnimatePresence>

          {/* Chat widget (bottom-right) */}
          <div className="fixed right-6 bottom-6 z-50">
            <AnimatePresence>
              {chatOpen ? (
                <motion.div initial={{ y: 30, opacity: 0 }} animate={{ y: 0, opacity: 1 }} exit={{ y: 30, opacity: 0 }} className="w-80 bg-sky-900/95 border border-sky-600/40 rounded-lg p-3 shadow-xl">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-sky-800/40 flex items-center justify-center">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden>
                        <path d="M12 3c-4 0-7 3-8 6 1 0 2 1 2 2v1h12V11c0-1 1-2 2-2-1-3-4-6-8-6z" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
                      </svg>
                    </div>
                    <div>
                      <div className="text-sm font-semibold">Miss Poppins</div>
                      <div className="text-xs text-sky-300/70">Whimsical guide • gentle prompts</div>
                    </div>
                  </div>

                  <div className="mt-3 h-40 overflow-auto rounded-md bg-sky-800/10 p-2 text-xs">Bot: Spit-spot! How may I guide your reflection today?</div>

                  <form className="mt-3 flex gap-2" onSubmit={(e)=>{e.preventDefault(); /* wire your send handler */}}>
                    <input className="flex-1 rounded-md px-3 py-2 bg-sky-800/20 border border-sky-700/30 text-sky-100" placeholder="Type a reflection..." />
                    <button className="px-3 py-2 rounded-md bg-sky-700/50">Send</button>
                  </form>
                </motion.div>
              ) : (
                <motion.button initial={{ scale: 0.98 }} animate={{ scale: 1 }} whileHover={{ scale: 1.04 }} onClick={() => setChatOpen(true)} className="w-14 h-14 rounded-full bg-sky-800/30 border border-sky-600/30 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-sky-400">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden>
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
                  </svg>
                </motion.button>
              )}
            </AnimatePresence>
          </div>

        </main>

        {/* Footer / Credits */}
        <footer className="mt-8 text-xs text-sky-300/60">Blueprint aesthetic built with love — edit SVGs and copy to match your content.</footer>
      </div>
    </div>
  );
}


/**
 * VirtueTile - small component used to render each virtue in the left/right stacks
 * Kept inside the same file for single-file convenience. Uses simple hover
 * animations and exposes an open action.
 */
function VirtueTile({ virtue, onOpen, isOpen, index }){
  return (
    <motion.article
      initial={{ opacity: 0, y: 8 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.06 }}
      className="rounded-xl p-4 bg-sky-900/40 border border-sky-700/30"
    >
      <div className="flex items-start gap-3">
        <div className="w-12 h-12 rounded-md bg-sky-800/20 border border-sky-600/30 flex items-center justify-center">
          {/* simple teacup icon */}
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M3 7h15v6a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V7z" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
            <path d="M21 10v2a3 3 0 0 1-3 3" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
          </svg>
        </div>

        <div className="flex-1">
          <h4 className="text-sm font-semibold">{virtue.title}</h4>
          <p className="text-xs text-sky-300/70 mt-1">{virtue.subtitle}</p>
          <p className="text-xs text-sky-300/60 mt-2 line-clamp-2">{virtue.prompt}</p>
        </div>

        <div className="flex flex-col gap-2">
          <button onClick={onOpen} className="rounded-md px-3 py-1 bg-sky-700/50 border border-sky-600/30 text-xs">Open</button>
        </div>
      </div>
    </motion.article>
  );
}
