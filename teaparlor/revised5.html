<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Whimsical Parlour Chat Adventure</title>
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
<style>
  body {
    margin:0;
    font-family:'Patrick Hand', cursive;
    background: url('https://i.imgur.com/qM6RZKq.png') no-repeat center top;
    background-size: cover;
    color: #fff;
    overflow-x: hidden;
  }

  /* Chat area */
  #chat-container {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 600px;
    height: 350px;
    background: rgba(25,0,50,0.7);
    border-radius: 15px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    box-shadow: 0 0 15px #7b68ee;
  }

  .chat-message {
    margin: 5px 0;
    padding: 8px 12px;
    border-radius: 12px;
    max-width: 80%;
    background: rgba(255,255,255,0.1);
  }

  .chat-message.user {
    align-self: flex-end;
    background: rgba(100,149,237,0.7);
  }

  .chat-message.bot {
    align-self: flex-start;
    background: rgba(138,43,226,0.6);
  }

  #user-input {
    margin-top: auto;
    display:flex;
  }

  #user-input input {
    flex:1;
    padding:10px;
    border-radius:8px 0 0 8px;
    border:none;
    outline:none;
    font-family:'Patrick Hand', cursive;
  }

  #user-input button {
    padding:10px;
    border:none;
    background: #7b68ee;
    color:white;
    cursor:pointer;
    border-radius:0 8px 8px 0;
    font-family:'Patrick Hand', cursive;
  }

  /* Virtues shelf */
  #virtue-shelf {
    position: fixed;
    top: 20%;
    right: 10px;
    display:flex;
    flex-direction: column;
    gap: 15px;
    z-index: 2;
  }

  .virtue-icon {
    width:50px;
    height:50px;
    background: rgba(255,255,255,0.2);
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 24px;
    cursor:pointer;
    position: relative;
  }

  /* Floating Steam */
  .steam {
    position:fixed; bottom:50px; left:50px; width:20px; height:20px;
    background:rgba(255,255,255,0.2); border-radius:50%;
    animation: rise 6s infinite ease-in;
    filter:blur(4px);
    z-index:0;
  }
  @keyframes rise {
    0%{transform:translateY(0) scale(1);opacity:0.4;}
    50%{opacity:0.8;}
    100%{transform:translateY(-200px) scale(1.5);opacity:0;}
  }

  /* Sparkles */
  .sparkle {
    position:fixed; width:5px; height:5px; background:white;
    border-radius:50%; opacity:0.8;
    animation: twinkle 3s infinite;
    z-index:1;
  }
  @keyframes twinkle {
    0%,100%{opacity:0.2; transform:scale(1);}
    50%{opacity:1; transform:scale(1.5);}
  }

  /* Music Drawer */
  #music-drawer {
    position: fixed;
    top:50%;
    right: -250px;
    transform: translateY(-50%);
    width: 220px;
    background: rgba(50,0,100,0.9);
    border-radius: 12px 0 0 12px;
    padding: 10px;
    transition: right 0.5s ease;
    font-family:'Patrick Hand', cursive;
    box-shadow: -2px 2px 15px #7b68ee;
    z-index: 3;
  }

  #music-drawer h3 {
    margin-top:0; font-size:18px; text-align:center; font-family:'Patrick Hand', cursive;
  }

  .music-track {
    margin:8px 0;
    cursor:pointer;
  }

  #music-drawer.open { right: 0; }

</style>
</head>
<body>

<!-- Virtues Shelf -->
<div id="virtue-shelf">
  <div class="virtue-icon" title="Etiquette">ü´ñ</div>
  <div class="virtue-icon" title="Lore">üìö</div>
  <div class="virtue-icon" title="Herb Garden">üåø</div>
  <div class="virtue-icon" title="Proverbs & Poetry">üñãÔ∏è</div>
</div>

<!-- Chat container -->
<div id="chat-container">
  <div class="chat-message bot">Spit-spot! Welcome to the Parlour. Tea, wisdom, or adventure today?</div>
  <div id="user-input">
    <input type="text" id="user-text" placeholder="Type your reply...">
    <button id="send-btn">Enter</button>
  </div>
</div>

<!-- Music Drawer -->
<div id="music-drawer">
  <h3>Theme Music</h3>
  <div class="music-track" data-src="track1.mp3">Gentle Chimes</div>
  <div class="music-track" data-src="track2.mp3">Soft Strings</div>
  <div class="music-track" data-src="track3.mp3">Ambient Flow</div>
  <div class="music-track" data-src="track4.mp3">Evening Calm</div>
  <audio id="music-player" loop></audio>
</div>

<script>
  const chatContainer = document.getElementById('chat-container');
  const userInput = document.getElementById('user-text');
  const sendBtn = document.getElementById('send-btn');
  const musicDrawer = document.getElementById('music-drawer');
  const musicPlayer = document.getElementById('music-player');

  // Helper: add chat message
  function addMessage(text, sender='bot'){
    const msg = document.createElement('div');
    msg.classList.add('chat-message', sender);
    msg.innerText=text;
    chatContainer.insertBefore(msg, document.getElementById('user-input'));
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  // Music Drawer Riddle Logic
  let riddleAnswered=false;
  const mannersRiddle = "If I offer my hand politely, what is my next step?";
  const riddleAnswer = "bow";

  function checkRiddle(input){
    if(input.toLowerCase().includes(riddleAnswer)){
      riddleAnswered=true;
      musicDrawer.classList.add('open');
      addMessage("Splendid! The music drawer slides open with gentle notes.", 'bot');
    } else {
      addMessage("Hmm, not quite. Consider manners carefully.", 'bot');
    }
  }

  // Chat responses
  function botResponse(input){
    const text=input.toLowerCase();
    if(text.includes('tea')){
      addMessage("Ah, tea! Shall we try Black, Matcha, Chai, or Boba?", 'bot');
    } else if(text.includes('music')){
      if(!riddleAnswered){
        addMessage(`To unlock the music, answer this riddle: ${mannersRiddle}`, 'bot');
      }
    } else if(riddleAnswered && text.includes('play')){
      musicPlayer.play();
      addMessage("Playing the gentle ambient tunes...", 'bot');
    } else if(text.includes('stop') || text.includes('pause')){
      musicPlayer.pause();
      addMessage("Music paused.", 'bot');
    } else if(text.includes('quest')){
      addMessage("Your adventure awaits! Choose: Level 1 - Mindfulness, Level 2 - Self-Care, Level 3 - Personal Growth.", 'bot');
    } else {
      // If riddle expected
      if(!riddleAnswered && text.includes(riddleAnswer)){
        checkRiddle(text);
      } else {
        addMessage("Splendid! Tell me more, dear friend.", 'bot');
      }
    }
  }

  // Send button and Enter key
  sendBtn.onclick = ()=>{ 
    const text=userInput.value;
    if(text.trim()==='') return;
    addMessage(text,'user');
    botResponse(text);
    userInput.value='';
  }

  userInput.addEventListener("keypress", function(e){
    if(e.key==='Enter'){ sendBtn.click(); }
  });

  // Music track selection
  document.querySelectorAll('.music-track').forEach(track=>{
    track.addEventListener('click', ()=>{
      musicPlayer.src=track.getAttribute('data-src');
      musicPlayer.play();
    });
  });

  // Floating Steam & Sparkles
  for(let i=0;i<8;i++){
    let s=document.createElement('div'); s.classList.add('steam');
    s.style.left=(50+Math.random()*50)+'px';
    s.style.animationDelay=(Math.random()*3)+'s';
    document.body.appendChild(s);
  }

  for(let i=0;i<15;i++){
    let sp=document.createElement('div'); sp.classList.add('sparkle');
    sp.style.left=(Math.random()*window.innerWidth)+'px';
    sp.style.top=(Math.random()*window.innerHeight)+'px';
    sp.style.animationDelay=(Math.random()*3)+'s';
    document.body.appendChild(sp);
  }
</script>
</body>
</html>
